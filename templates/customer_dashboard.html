{% extends 'base_dashboard.html' %}
{% block content %}
<main class="dashboard">
    <nav class="nav nav-tabs nav-pills flex-column text-center p-4">
        <h4 class="h2 py-3 py-xl-5">Dashboard</h4>
        <button class="fs-5 pr-2 nav-link active" data-bs-toggle="tab" data-bs-target="#featured" type="button"
            role="tab">
            <span class="material-icons align-middle">menu_book</span>
            Menu
        </button>
        <button style="white-space: nowrap;" class="fs-5 pr-2 nav-link" data-bs-toggle="tab"
            data-bs-target="#order_status" type="button" role="tab">
            <span class="material-icons align-middle">schedule</span>
            Order Status
        </button>

    </nav>


    <div class="flex-grow-1 tab-content p-md-5 bg-light">
        <section class="tab-pane active in" role="tabpanel" id="featured">
            <!-- <div class="row"> -->
            <!-- <img src="{{ url_for('static', filename='images/menu.jpg') }}" alt="" class="d-none d-xl-block col-xl-4"> -->

            <div class="p-5">
                <h2>Menu</h2>
                <p>
                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Voluptate fugit expedita minima,
                    aperiam error ut.
                </p>
                {% set v = {'s': False, 'm': False, 'd': False, 'b': False, 'f': False} %}
                {% for item in menu %}
                {% if not v.s and item.type == 's' %}
                <div class="card border-primary">
                    <div class="card-header text-primary h4 p-3">Starters</div>
                    <div class="card-body">
                        <div class="card-deck">
                            {% if v.update({'s': True, 'm': False, 'd': False, 'b': False, 'f': False}) %} {% endif %}
                            {% endif %}

                            {% if not v.m and item.type == 'm' %}
                        </div>
                    </div>
                </div>
                <br>
                <div class="card border-primary">
                    <div class="card-header text-primary h4 p-3">Main Course</div>
                    <div class="card-body">
                        <div class="card-deck">
                            {% if v.update({'s': True, 'm': True, 'd': False, 'b': False, 'f': False}) %} {% endif %}
                            {% endif %}

                            {% if not v.d and item.type == 'd' %}
                        </div>
                    </div>
                </div>
                <br>
                <div class="card border-primary">
                    <div class="card-header text-primary h4 p-3">Dessert</div>
                    <div class="card-body">
                        <div class="card-deck">
                            {% if v.update({'s': True, 'm': True, 'd': True, 'b': False, 'f': False}) %} {% endif %}
                            {% endif %}

                            {% if not v.b and item.type == 'b' %}
                        </div>
                    </div>
                </div>
                <br>
                <div class="card border-primary">
                    <div class="card-header text-primary h4 p-3">Beverages</div>
                    <div class="card-body">
                        <div class="card-deck">
                            {% if v.update({'s': True, 'm': True, 'd': True, 'b': True, 'f': False}) %} {% endif %}
                            {% endif %}
                            <div class="card border-dark">
                                <img src="{{ url_for('static', filename='images/'+ item.name +'.jpg') }}"
                                    class="card-img-top" alt="...">
                                <div class="card-body d-flex flex-column">
                                    <h3 class="card-title d-inline-flex justify-content-between w-100">
                                        <span>{{ item.name }}</span>
                                        <span>AED {{ '%.2f' % item.price }}</span>
                                    </h3>
                                    <p class="card-text">{{ item.desc }}</p>
                                    <div class="btn-group w-100 mt-auto" role="group">
                                        <a onclick="dec('{{ item.type }}{{ item.id }}');" type="button"
                                            class="btn btn-danger text-light" type="button"><span
                                                class="material-icons">remove</span></a>
                                        <a class="btn p-0 fs-3" id="{{ item.type }}{{ item.id }}">0</a>
                                        <a class="btn btn-primary text-light" type="button"
                                            onclick="inc('{{ item.type }}{{ item.id }}');"><span
                                                class="material-icons">add</span></a>
                                    </div>
                                </div>
                            </div>
                            {% if item == menu[-1] %}
                            {% if v.update({'s': True, 'm': True, 'd': True, 'b': True, 'f': True}) %} {% endif %}
                            {% endif %}
                            {% if v.s and v.m and v.d and v.b and v.f %}
                        </div>
                    </div>
                </div>
                <br>
                {% endif %}
                {% endfor %}
                <div class="text-center">
                    <a class="btn btn-primary text-light w-50" onclick="placeOrder();">Place Order</a>
                </div>
            </div>
            <!-- </div> -->

        </section>
        <section class="tab-pane fade" role="tabpanel" id="order_status">
            <h3>Orders</h3>
            <div class="card card-deck py-4 px-3">
                <div class="card bg-light text-primary p-3">
                    <strong class="card-title">Order 3</strong>
                    <ul class="card-body">
                        <li>Chicken</li>
                        <li>Pasta</li>
                    </ul>
                    <strong class="card-footer">Preparing</strong>
                </div>
                <div class="card bg-primary text-light p-3">
                    <strong class="card-title">Order 1</strong>
                    <ul class="card-body">
                        <li>Pasta</li>
                        <li>Chicken</li>
                    </ul>
                    <strong class="card-footer">Served</strong>
                </div>
                <div class="card bg-primary text-light p-3">
                    <strong class="card-title">Order 2</strong>
                    <ul class="card-body">
                        <li>Salad</li>
                        <li>Soup</li>
                        <li>Chicken</li>
                    </ul>
                    <strong class="card-footer">Served</strong>
                </div>
            </div>
    </div>
</main>

<script>
    function inc(id) {
        document.getElementById(id).innerHTML = parseInt(document.getElementById(id).innerHTML) + 1;
    }

    function dec(id) {
        var qty = parseInt(document.getElementById(id).innerHTML);
        document.getElementById(id).innerHTML = (qty == 0) ? 0 : qty - 1;
    }

    function placeOrder() {
        var xhr = new XMLHttpRequest();
        var data = {};
        var i = 0;
        while (true) {
            var ele = document.getElementById("m" + i);
            if (ele) {
                data["m" + i] = ele.innerHTML;
            }
            else {
                ele = document.getElementById("s" + i);
                if (ele) {
                    data["s" + i] = ele.innerHTML;
                }
                else {
                    ele = document.getElementById("b" + i);
                    if (ele) {
                        data["b" + i] = ele.innerHTML;
                    }
                    else {
                        ele = document.getElementById("d" + i);
                        if (ele) {
                            data["d" + i] = ele.innerHTML;
                        }
                        else {
                            break;
                        }
                    }
                }
            }
            i = i + 1;
        }

        xhr.open("POST", "/place", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(data));
        if (xhr.readyState == XMLHttpRequest.DONE) {
            console.log(xhr.responseText);
        }
        console.log(xhr.responseText);
    }
</script>
{% endblock content %}